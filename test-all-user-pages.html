<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test All User Pages - HACOM</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .page-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        background: #f9f9f9;
      }
      .page-card h3 {
        margin-top: 0;
        color: #333;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
      }
      .status-loading {
        background: #ffc107;
      }
      .status-success {
        background: #28a745;
      }
      .status-error {
        background: #dc3545;
      }
      .test-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px 0;
        width: 100%;
      }
      .test-btn:hover {
        background: #0056b3;
      }
      .test-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
      }
      .error-details {
        background: #fff;
        border: 1px solid #dc3545;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
        font-size: 12px;
        color: #721c24;
      }
      .success-details {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
        font-size: 12px;
        color: #155724;
      }
      .summary {
        background: #e9ecef;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .progress-bar {
        width: 100%;
        height: 20px;
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background: #28a745;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test All User Pages - HACOM SEO</h1>

    <div class="summary">
      <h3>üìä Test Summary</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar" style="width: 0%"></div>
      </div>
      <p>Progress: <span id="progressText">0/0</span></p>
      <p>‚úÖ Success: <span id="successCount">0</span></p>
      <p>‚ùå Errors: <span id="errorCount">0</span></p>
      <p>‚è≥ Pending: <span id="pendingCount">0</span></p>
    </div>

    <div style="margin: 20px 0">
      <button
        onclick="testAllPages()"
        class="test-btn"
        style="background: #28a745"
      >
        üöÄ Test All Pages
      </button>
      <button
        onclick="testCriticalPages()"
        class="test-btn"
        style="background: #ffc107"
      >
        ‚ö° Test Critical Pages Only
      </button>
      <button
        onclick="clearResults()"
        class="test-btn"
        style="background: #6c757d"
      >
        üóëÔ∏è Clear Results
      </button>
    </div>

    <div class="test-grid" id="testGrid">
      <!-- Pages will be populated by JavaScript -->
    </div>

    <script>
      const userPages = [
        // Main pages
        { name: "Trang ch·ªß", url: "/", critical: true },
        { name: "S·∫£n ph·∫©m", url: "/products", critical: true },
        { name: "Gi·ªè h√†ng", url: "/cart", critical: true },
        { name: "Thanh to√°n", url: "/checkout", critical: true },

        // User pages
        { name: "ƒêƒÉng nh·∫≠p", url: "/login", critical: true },
        { name: "ƒêƒÉng k√Ω", url: "/register", critical: true },
        { name: "Th√¥ng tin c√° nh√¢n", url: "/profile", critical: false },
        { name: "ƒê∆°n h√†ng c·ªßa t√¥i", url: "/orders", critical: false },
        { name: "Thanh to√°n & H√≥a ƒë∆°n", url: "/billing", critical: false },

        // Success pages
        { name: "ƒê·∫∑t h√†ng th√†nh c√¥ng", url: "/thank-you", critical: false },
        { name: "Theo d√µi ƒë∆°n h√†ng", url: "/track-order", critical: false },

        // Product pages (examples)
        { name: "Chi ti·∫øt s·∫£n ph·∫©m (1)", url: "/products/1", critical: true },
        { name: "Chi ti·∫øt s·∫£n ph·∫©m (2)", url: "/products/2", critical: false },

        // Category pages (examples)
        { name: "Danh m·ª•c Laptop", url: "/category/laptop", critical: true },
        { name: "Danh m·ª•c Gaming", url: "/category/gaming", critical: false },

        // Other pages
        { name: "Buy Now Checkout", url: "/buy-now-checkout", critical: false },
        { name: "Guest Checkout", url: "/guest-checkout", critical: false },
        { name: "Tr·∫°ng th√°i h·ªá th·ªëng", url: "/status", critical: false },
      ];

      let testResults = {};
      let currentTests = 0;
      let totalTests = 0;

      function initializeTestGrid() {
        const grid = document.getElementById("testGrid");
        grid.innerHTML = "";

        userPages.forEach((page) => {
          const card = document.createElement("div");
          card.className = "page-card";
          card.id = `card-${page.url.replace(/[^a-zA-Z0-9]/g, "_")}`;

          card.innerHTML = `
                    <h3>
                        <span class="status-indicator" id="status-${page.url.replace(/[^a-zA-Z0-9]/g, "_")}"></span>
                        ${page.name}
                        ${page.critical ? "‚≠ê" : ""}
                    </h3>
                    <p><strong>URL:</strong> ${page.url}</p>
                    <p><strong>Type:</strong> ${page.critical ? "Critical" : "Standard"}</p>
                    <button onclick="testSinglePage('${page.url}')" class="test-btn">Test This Page</button>
                    <div id="result-${page.url.replace(/[^a-zA-Z0-9]/g, "_")}" class="result-container"></div>
                `;

          grid.appendChild(card);
        });
      }

      async function testSinglePage(url) {
        const pageId = url.replace(/[^a-zA-Z0-9]/g, "_");
        const statusEl = document.getElementById(`status-${pageId}`);
        const resultEl = document.getElementById(`result-${pageId}`);

        // Set loading state
        statusEl.className = "status-indicator status-loading";
        resultEl.innerHTML = "<p>üîÑ Testing...</p>";

        try {
          const response = await fetch(`http://localhost:3000${url}`, {
            method: "HEAD",
            mode: "no-cors",
          });

          // Try to load the page in an iframe to test for JS errors
          const testFrame = document.createElement("iframe");
          testFrame.style.display = "none";
          testFrame.src = `http://localhost:3000${url}`;

          return new Promise((resolve) => {
            const timeout = setTimeout(() => {
              document.body.removeChild(testFrame);
              statusEl.className = "status-indicator status-error";
              resultEl.innerHTML =
                '<div class="error-details">‚è∞ Timeout - Page took too long to load</div>';
              testResults[url] = { status: "error", error: "Timeout" };
              resolve(false);
            }, 10000);

            testFrame.onload = () => {
              clearTimeout(timeout);
              document.body.removeChild(testFrame);
              statusEl.className = "status-indicator status-success";
              resultEl.innerHTML =
                '<div class="success-details">‚úÖ Page loaded successfully</div>';
              testResults[url] = { status: "success" };
              resolve(true);
            };

            testFrame.onerror = () => {
              clearTimeout(timeout);
              document.body.removeChild(testFrame);
              statusEl.className = "status-indicator status-error";
              resultEl.innerHTML =
                '<div class="error-details">‚ùå Failed to load page</div>';
              testResults[url] = { status: "error", error: "Load failed" };
              resolve(false);
            };

            document.body.appendChild(testFrame);
          });
        } catch (error) {
          statusEl.className = "status-indicator status-error";
          resultEl.innerHTML = `<div class="error-details">‚ùå Error: ${error.message}</div>`;
          testResults[url] = { status: "error", error: error.message };
          return false;
        }
      }

      async function testAllPages() {
        totalTests = userPages.length;
        currentTests = 0;
        updateProgress();

        for (const page of userPages) {
          await testSinglePage(page.url);
          currentTests++;
          updateProgress();

          // Small delay between tests
          await new Promise((resolve) => setTimeout(resolve, 500));
        }

        showFinalReport();
      }

      async function testCriticalPages() {
        const criticalPages = userPages.filter((page) => page.critical);
        totalTests = criticalPages.length;
        currentTests = 0;
        updateProgress();

        for (const page of criticalPages) {
          await testSinglePage(page.url);
          currentTests++;
          updateProgress();

          // Small delay between tests
          await new Promise((resolve) => setTimeout(resolve, 500));
        }

        showFinalReport();
      }

      function updateProgress() {
        const progress = totalTests > 0 ? (currentTests / totalTests) * 100 : 0;
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById("progressText").textContent =
          `${currentTests}/${totalTests}`;

        const successCount = Object.values(testResults).filter(
          (r) => r.status === "success",
        ).length;
        const errorCount = Object.values(testResults).filter(
          (r) => r.status === "error",
        ).length;
        const pendingCount = totalTests - currentTests;

        document.getElementById("successCount").textContent = successCount;
        document.getElementById("errorCount").textContent = errorCount;
        document.getElementById("pendingCount").textContent = pendingCount;
      }

      function showFinalReport() {
        const successCount = Object.values(testResults).filter(
          (r) => r.status === "success",
        ).length;
        const errorCount = Object.values(testResults).filter(
          (r) => r.status === "error",
        ).length;

        let report = `\nüèÅ TEST COMPLETED!\n`;
        report += `‚úÖ Successful: ${successCount}\n`;
        report += `‚ùå Failed: ${errorCount}\n`;
        report += `üìä Success Rate: ${((successCount / totalTests) * 100).toFixed(1)}%\n`;

        if (errorCount > 0) {
          report += `\n‚ùå FAILED PAGES:\n`;
          Object.entries(testResults).forEach(([url, result]) => {
            if (result.status === "error") {
              report += `‚Ä¢ ${url}: ${result.error}\n`;
            }
          });
        }

        console.log(report);
        alert(report);
      }

      function clearResults() {
        testResults = {};
        currentTests = 0;
        totalTests = 0;
        updateProgress();

        // Clear all status indicators and results
        document.querySelectorAll(".status-indicator").forEach((el) => {
          el.className = "status-indicator";
        });
        document.querySelectorAll(".result-container").forEach((el) => {
          el.innerHTML = "";
        });
      }

      // Initialize the test grid when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initializeTestGrid();
        updateProgress();

        console.log("üß™ User Pages Test Suite Loaded");
        console.log(`üìã Total pages to test: ${userPages.length}`);
        console.log(
          `‚≠ê Critical pages: ${userPages.filter((p) => p.critical).length}`,
        );
      });

      // Auto-test critical pages on load (optional)
      // setTimeout(() => testCriticalPages(), 2000);
    </script>
  </body>
</html>
