<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Image Logic - HACOM SEO</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      .test-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        background: #f9f9f9;
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
      }
      .image-test {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
      .image-card {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 15px;
        background: white;
      }
      .image-preview {
        width: 100%;
        height: 150px;
        background: #f0f0f0;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px 0;
        font-size: 12px;
        color: #666;
      }
      .image-preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
        border-radius: 4px;
      }
      .url-display {
        background: #f8f8f8;
        padding: 8px;
        border-radius: 4px;
        font-size: 12px;
        word-break: break-all;
        margin: 5px 0;
      }
      .status {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: bold;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
      }
      .test-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .test-btn:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>üñºÔ∏è Test Image Logic - HACOM SEO</h1>

    <div class="test-section">
      <h3>üìù Test Logic Description</h3>
      <p><strong>New Logic:</strong></p>
      <ul>
        <li>
          üîπ <strong>Product pages:</strong> Use actual product image from
          <code>${Domain}/uploads/image.jpg</code>
        </li>
        <li>
          üîπ <strong>Category pages:</strong> Use actual category image from
          <code>${Domain}/uploads/image.jpg</code>
        </li>
        <li>
          üîπ <strong>Fallback:</strong> If no actual image, use SEO settings
          default images
        </li>
        <li>
          üîπ <strong>Backend API:</strong> Images served from
          <code>http://localhost:4000/uploads/</code>
        </li>
      </ul>
    </div>

    <div class="test-section">
      <h3>üß™ Product Image Tests</h3>
      <div class="image-test" id="productTests">
        <!-- Will be populated by JavaScript -->
      </div>
      <button class="test-btn" onclick="testProductImages()">
        üîÑ Test Product Images
      </button>
    </div>

    <div class="test-section">
      <h3>üè∑Ô∏è Category Image Tests</h3>
      <div class="image-test" id="categoryTests">
        <!-- Will be populated by JavaScript -->
      </div>
      <button class="test-btn" onclick="testCategoryImages()">
        üîÑ Test Category Images
      </button>
    </div>

    <div class="test-section">
      <h3>üìä Expected Image URLs</h3>
      <div class="url-display">
        <strong>Product Images:</strong><br />
        ‚Ä¢ With image:
        <code
          >http://localhost:4000/uploads/file-1754323204656-522680178.jpg</code
        ><br />
        ‚Ä¢ Without image:
        <code>SEO settings product_og_image or default_og_image</code>
      </div>
      <div class="url-display">
        <strong>Category Images:</strong><br />
        ‚Ä¢ With image:
        <code>http://localhost:4000/uploads/category-image.jpg</code><br />
        ‚Ä¢ Without image:
        <code>SEO settings category_og_image or default_og_image</code>
      </div>
    </div>

    <script>
      const Domain = "http://localhost:4000";

      const testProducts = [
        {
          id: 1,
          name: "Laptop Gaming",
          expectedImage: `${Domain}/uploads/file-1754323204656-522680178.jpg`,
        },
        { id: 2, name: "PC Desktop", expectedImage: null },
        {
          id: 7,
          name: "Gaming Gear",
          expectedImage: `${Domain}/uploads/product-image.jpg`,
        },
      ];

      const testCategories = [
        {
          slug: "laptop",
          name: "Laptop",
          expectedImage: `${Domain}/uploads/category-laptop.jpg`,
        },
        { slug: "gaming", name: "Gaming", expectedImage: null },
        {
          slug: "pc-desktop",
          name: "PC Desktop",
          expectedImage: `${Domain}/uploads/category-pc.jpg`,
        },
      ];

      function createImageCard(item, type, expectedImage) {
        const status = expectedImage ? "success" : "warning";
        const statusText = expectedImage ? "Has Image" : "No Image (Fallback)";

        return `
                <div class="image-card">
                    <h4>${item.name} <span class="status ${status}">${statusText}</span></h4>
                    <div class="image-preview">
                        ${
                          expectedImage
                            ? `<img src="${expectedImage}" alt="${item.name}" onerror="this.parentElement.innerHTML='‚ùå Image not found'">`
                            : "üñºÔ∏è Using fallback image"
                        }
                    </div>
                    <div class="url-display">
                        <strong>Expected URL:</strong><br>
                        ${expectedImage || "SEO settings fallback"}
                    </div>
                    <div class="url-display">
                        <strong>Test URL:</strong><br>
                        ${type === "product" ? `/products/${item.id}` : `/category/${item.slug}`}
                    </div>
                </div>
            `;
      }

      function testProductImages() {
        const container = document.getElementById("productTests");
        container.innerHTML = testProducts
          .map((product) =>
            createImageCard(product, "product", product.expectedImage),
          )
          .join("");

        console.log("üß™ Testing Product Images:", testProducts);
      }

      function testCategoryImages() {
        const container = document.getElementById("categoryTests");
        container.innerHTML = testCategories
          .map((category) =>
            createImageCard(category, "category", category.expectedImage),
          )
          .join("");

        console.log("üß™ Testing Category Images:", testCategories);
      }

      // Test actual metadata extraction
      async function testMetadataExtraction(url) {
        try {
          const response = await fetch(url);
          const html = await response.text();

          // Extract og:image from HTML
          const ogImageMatch = html.match(
            /<meta\s+property="og:image"\s+content="([^"]+)"/,
          );
          const ogImage = ogImageMatch ? ogImageMatch[1] : null;

          console.log(`üìã Metadata for ${url}:`, {
            ogImage,
            expectedPattern: Domain + "/uploads/",
            isCorrect: ogImage && ogImage.includes("/uploads/"),
          });

          return ogImage;
        } catch (error) {
          console.error(`‚ùå Error testing ${url}:`, error);
          return null;
        }
      }

      // Auto-test on load
      document.addEventListener("DOMContentLoaded", function () {
        testProductImages();
        testCategoryImages();

        console.log("üîç Image Logic Test Suite Loaded");
        console.log("üìã Domain:", Domain);
        console.log("üñºÔ∏è Expected image pattern:", Domain + "/uploads/");

        // Test some actual URLs
        setTimeout(() => {
          console.log("üß™ Testing actual metadata extraction...");
          testMetadataExtraction("http://localhost:3000/products/1");
          testMetadataExtraction("http://localhost:3000/category/laptop");
        }, 2000);
      });

      // Test Open Graph validators
      function testOnSocialPlatforms(pageUrl) {
        const testUrls = {
          facebook: `https://developers.facebook.com/tools/debug/?q=${encodeURIComponent(pageUrl)}`,
          twitter: `https://cards-dev.twitter.com/validator`,
          linkedin: `https://www.linkedin.com/post-inspector/`,
          opengraph: `https://www.opengraph.xyz/?url=${encodeURIComponent(pageUrl)}`,
        };

        Object.entries(testUrls).forEach(([platform, url]) => {
          console.log(`üîó Test on ${platform}:`, url);
        });

        return testUrls;
      }

      // Add test buttons for specific pages
      function addTestButtons() {
        const container = document.createElement("div");
        container.innerHTML = `
                <div class="test-section">
                    <h3>üîó Test Specific Pages</h3>
                    <button class="test-btn" onclick="window.open('http://localhost:3000/products/1', '_blank')">Test Product #1</button>
                    <button class="test-btn" onclick="window.open('http://localhost:3000/products/7', '_blank')">Test Product #7</button>
                    <button class="test-btn" onclick="window.open('http://localhost:3000/category/laptop', '_blank')">Test Category: Laptop</button>
                    <button class="test-btn" onclick="window.open('http://localhost:3000/category/gaming', '_blank')">Test Category: Gaming</button>
                </div>
            `;
        document.body.appendChild(container);
      }

      // Add test buttons when page loads
      document.addEventListener("DOMContentLoaded", addTestButtons);
    </script>
  </body>
</html>
