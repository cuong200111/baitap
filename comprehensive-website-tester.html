<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üß™ Comprehensive Website Tester</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: system-ui, -apple-system, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8fafc;
        line-height: 1.6;
      }
      .container {
        max-width: 1400px;
        margin: 0 auto;
      }
      .header {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .test-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }
      .test-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .test-section h3 {
        margin-top: 0;
        color: #374151;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        margin: 4px;
        transition: all 0.2s;
      }
      .btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }
      .btn-test {
        background: #059669;
      }
      .btn-test:hover {
        background: #047857;
      }
      .btn-admin {
        background: #dc2626;
      }
      .btn-admin:hover {
        background: #b91c1c;
      }
      .test-results {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin: 12px 0;
        font-family: monospace;
        font-size: 13px;
        max-height: 400px;
        overflow-y: auto;
      }
      .test-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        margin: 4px 0;
        background: #f8fafc;
        border-radius: 6px;
        border-left: 4px solid #cbd5e1;
      }
      .test-item.testing {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }
      .test-item.success {
        border-left-color: #22c55e;
        background: #f0fdf4;
      }
      .test-item.error {
        border-left-color: #ef4444;
        background: #fef2f2;
      }
      .test-item.warning {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }
      .status-icon {
        font-size: 16px;
        margin-left: 8px;
      }
      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
        margin: 12px 0;
      }
      .progress-fill {
        height: 100%;
        background: #3b82f6;
        transition: width 0.3s ease;
      }
      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 12px;
        margin: 20px 0;
      }
      .stat-card {
        background: white;
        padding: 16px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #cbd5e1;
      }
      .stat-card.success {
        border-left-color: #22c55e;
      }
      .stat-card.error {
        border-left-color: #ef4444;
      }
      .stat-card.warning {
        border-left-color: #f59e0b;
      }
      .stat-number {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 4px;
      }
      .stat-label {
        color: #6b7280;
        font-size: 12px;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 16px 0;
      }
      .error-details {
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 12px;
        margin: 8px 0;
        font-size: 12px;
      }
      .url-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        margin-right: 8px;
      }
      @media (max-width: 768px) {
        .test-grid {
          grid-template-columns: 1fr;
        }
        .container {
          padding: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üß™ Comprehensive Website Tester</h1>
        <p>Tool test to√†n b·ªô website - User pages & Admin pages v·ªõi ph√°t hi·ªán l·ªói t·ª± ƒë·ªông</p>
        
        <div class="controls">
          <input type="text" id="baseUrl" class="url-input" value="https://20bdfb1e64e3483694c7ba59225ae1a6-ffe7619288fb40b59e347ff8b.fly.dev" placeholder="Base URL">
          <button class="btn btn-test" onclick="testAllPages()">üöÄ Test T·∫•t C·∫£ Trang</button>
          <button class="btn" onclick="testUserPages()">üë§ Test User Pages</button>
          <button class="btn btn-admin" onclick="testAdminPages()">‚öôÔ∏è Test Admin Pages</button>
          <button class="btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div class="progress-bar" style="display: none;" id="progressBar">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="summary-stats" id="summaryStats" style="display: none;">
          <div class="stat-card success">
            <div class="stat-number" id="successCount">0</div>
            <div class="stat-label">Th√†nh C√¥ng</div>
          </div>
          <div class="stat-card error">
            <div class="stat-number" id="errorCount">0</div>
            <div class="stat-label">L·ªói</div>
          </div>
          <div class="stat-card warning">
            <div class="stat-number" id="warningCount">0</div>
            <div class="stat-label">C·∫£nh B√°o</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">T·ªïng C·ªông</div>
          </div>
        </div>
      </div>

      <div class="test-grid">
        <div class="test-section">
          <h3>üë§ User Pages Results</h3>
          <div class="test-results" id="userResults">
            <div class="test-item">
              <span>Ch∆∞a test trang n√†o</span>
              <span class="status-icon">‚è≥</span>
            </div>
          </div>
        </div>

        <div class="test-section">
          <h3>‚öôÔ∏è Admin Pages Results</h3>
          <div class="test-results" id="adminResults">
            <div class="test-item">
              <span>Ch∆∞a test trang n√†o</span>
              <span class="status-icon">‚è≥</span>
            </div>
          </div>
        </div>
      </div>

      <div class="test-section" id="errorSection" style="display: none;">
        <h3>üö® Chi Ti·∫øt L·ªói</h3>
        <div id="errorDetails"></div>
      </div>
    </div>

    <script>
      // Comprehensive page list for testing
      const USER_PAGES = [
        { path: '/', name: 'Trang ch·ªß', subpages: [] },
        { path: '/products', name: 'Danh s√°ch s·∫£n ph·∫©m', subpages: ['/products/1', '/products/7'] },
        { path: '/category/laptop', name: 'Category laptop', subpages: ['/category/dien-thoai', '/category/gaming'] },
        { path: '/cart', name: 'Gi·ªè h√†ng', subpages: [] },
        { path: '/checkout', name: 'Thanh to√°n', subpages: ['/guest-checkout', '/buy-now-checkout'] },
        { path: '/login', name: 'ƒêƒÉng nh·∫≠p', subpages: [] },
        { path: '/register', name: 'ƒêƒÉng k√Ω', subpages: [] },
        { path: '/profile', name: 'H·ªì s∆°', subpages: [] },
        { path: '/orders', name: 'ƒê∆°n h√†ng', subpages: [] },
        { path: '/billing', name: 'Thanh to√°n', subpages: [] },
        { path: '/thank-you', name: 'C·∫£m ∆°n', subpages: [] },
        { path: '/track-order', name: 'Theo d√µi ƒë∆°n h√†ng', subpages: [] }
      ];

      const ADMIN_PAGES = [
        { path: '/admin', name: 'Admin Dashboard', subpages: [] },
        { path: '/admin/products', name: 'Qu·∫£n l√Ω s·∫£n ph·∫©m', subpages: [] },
        { path: '/admin/categories', name: 'Qu·∫£n l√Ω danh m·ª•c', subpages: [] },
        { path: '/admin/orders', name: 'Qu·∫£n l√Ω ƒë∆°n h√†ng', subpages: [] },
        { path: '/admin/users', name: 'Qu·∫£n l√Ω ng∆∞·ªùi d√πng', subpages: [] },
        { path: '/admin/settings', name: 'C√†i ƒë·∫∑t', subpages: [] },
        { path: '/admin/media', name: 'Qu·∫£n l√Ω media', subpages: [] },
        { path: '/admin/reports', name: 'B√°o c√°o', subpages: [] },
        { path: '/admin/shipping', name: 'V·∫≠n chuy·ªÉn', subpages: [] },
        { path: '/admin/seo', name: 'SEO Settings', subpages: [] }
      ];

      let testStats = {
        total: 0,
        success: 0,
        error: 0,
        warning: 0,
        tested: 0
      };

      let allErrors = [];

      function updateProgress() {
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const progress = (testStats.tested / testStats.total) * 100;
        
        progressBar.style.display = 'block';
        progressFill.style.width = progress + '%';
        
        if (testStats.tested >= testStats.total) {
          setTimeout(() => {
            progressBar.style.display = 'none';
          }, 1000);
        }
      }

      function updateStats() {
        document.getElementById('successCount').textContent = testStats.success;
        document.getElementById('errorCount').textContent = testStats.error;
        document.getElementById('warningCount').textContent = testStats.warning;
        document.getElementById('totalCount').textContent = testStats.total;
        document.getElementById('summaryStats').style.display = 'grid';
      }

      function addTestResult(containerId, pageName, status, url, error = null) {
        const container = document.getElementById(containerId);
        const testItem = document.createElement('div');
        testItem.className = `test-item ${status}`;
        
        let statusIcon;
        switch (status) {
          case 'testing':
            statusIcon = 'üîÑ';
            break;
          case 'success':
            statusIcon = '‚úÖ';
            testStats.success++;
            break;
          case 'error':
            statusIcon = '‚ùå';
            testStats.error++;
            if (error) allErrors.push({ page: pageName, url, error });
            break;
          case 'warning':
            statusIcon = '‚ö†Ô∏è';
            testStats.warning++;
            break;
          default:
            statusIcon = '‚è≥';
        }
        
        testItem.innerHTML = `
          <span>${pageName}</span>
          <span class="status-icon">${statusIcon}</span>
        `;
        
        // Update existing item or add new one
        const existingItems = container.querySelectorAll('.test-item');
        let updated = false;
        existingItems.forEach(item => {
          if (item.querySelector('span').textContent === pageName) {
            item.className = `test-item ${status}`;
            item.querySelector('.status-icon').textContent = statusIcon;
            updated = true;
          }
        });
        
        if (!updated) {
          container.appendChild(testItem);
        }
        
        if (status !== 'testing') {
          testStats.tested++;
          updateProgress();
          updateStats();
        }
        
        // Show error details if there are errors
        if (allErrors.length > 0) {
          showErrorDetails();
        }
      }

      function showErrorDetails() {
        const errorSection = document.getElementById('errorSection');
        const errorDetails = document.getElementById('errorDetails');
        
        errorSection.style.display = 'block';
        
        let errorHTML = '';
        allErrors.forEach(error => {
          errorHTML += `
            <div class="error-details">
              <strong>üö® ${error.page}</strong><br>
              <strong>URL:</strong> ${error.url}<br>
              <strong>L·ªói:</strong> ${error.error}
            </div>
          `;
        });
        
        errorDetails.innerHTML = errorHTML;
      }

      async function testPage(url, pageName, containerId) {
        addTestResult(containerId, pageName, 'testing', url);
        
        try {
          const response = await fetch(url, { 
            method: 'GET',
            mode: 'no-cors' // Allow cross-origin requests
          });
          
          // Since we're using no-cors, we can't check response status
          // We'll consider it success if no error is thrown
          addTestResult(containerId, pageName, 'success', url);
          
          // Try to detect specific issues by testing the URL in a hidden iframe
          await testPageContent(url, pageName, containerId);
          
        } catch (error) {
          addTestResult(containerId, pageName, 'error', url, error.message);
        }
      }

      async function testPageContent(url, pageName, containerId) {
        return new Promise((resolve) => {
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          iframe.src = url;
          
          const timeout = setTimeout(() => {
            document.body.removeChild(iframe);
            addTestResult(containerId, `${pageName} (timeout)`, 'warning', url, 'Page load timeout');
            resolve();
          }, 10000); // 10 second timeout
          
          iframe.onload = () => {
            clearTimeout(timeout);
            try {
              // Try to access iframe content (will fail for cross-origin)
              const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
              
              // Check for common error indicators
              const title = iframeDoc.title.toLowerCase();
              if (title.includes('error') || title.includes('404') || title.includes('500')) {
                addTestResult(containerId, `${pageName} (error page)`, 'warning', url, `Page title indicates error: ${title}`);
              }
              
            } catch (e) {
              // Cross-origin restriction - this is expected for external URLs
              // We'll consider this normal
            }
            
            document.body.removeChild(iframe);
            resolve();
          };
          
          iframe.onerror = () => {
            clearTimeout(timeout);
            document.body.removeChild(iframe);
            addTestResult(containerId, `${pageName} (load error)`, 'error', url, 'Failed to load page');
            resolve();
          };
          
          document.body.appendChild(iframe);
        });
      }

      async function testPages(pages, containerId, delay = 500) {
        for (const page of pages) {
          const baseUrl = document.getElementById('baseUrl').value;
          const fullUrl = baseUrl + page.path;
          
          await testPage(fullUrl, page.name, containerId);
          await new Promise(resolve => setTimeout(resolve, delay)); // Delay between requests
          
          // Test subpages
          for (const subpage of page.subpages) {
            const subUrl = baseUrl + subpage;
            const subName = `${page.name} ‚Üí ${subpage}`;
            await testPage(subUrl, subName, containerId);
            await new Promise(resolve => setTimeout(resolve, delay);
          }
        }
      }

      async function testUserPages() {
        clearResults();
        document.getElementById('userResults').innerHTML = '';
        testStats.total = USER_PAGES.reduce((total, page) => total + 1 + page.subpages.length, 0);
        testStats.tested = 0;
        
        await testPages(USER_PAGES, 'userResults');
      }

      async function testAdminPages() {
        document.getElementById('adminResults').innerHTML = '';
        const currentTotal = testStats.total;
        testStats.total = currentTotal + ADMIN_PAGES.reduce((total, page) => total + 1 + page.subpages.length, 0);
        
        await testPages(ADMIN_PAGES, 'adminResults');
      }

      async function testAllPages() {
        clearResults();
        document.getElementById('userResults').innerHTML = '';
        document.getElementById('adminResults').innerHTML = '';
        
        testStats.total = [...USER_PAGES, ...ADMIN_PAGES].reduce((total, page) => total + 1 + page.subpages.length, 0);
        testStats.tested = 0;
        
        // Test user pages first
        await testPages(USER_PAGES, 'userResults', 300);
        
        // Then test admin pages
        await testPages(ADMIN_PAGES, 'adminResults', 300);
        
        console.log('üéâ Ho√†n th√†nh test t·∫•t c·∫£ trang!');
        console.log('üìä Th·ªëng k√™:', testStats);
        console.log('üö® L·ªói:', allErrors);
      }

      function clearResults() {
        document.getElementById('userResults').innerHTML = '<div class="test-item"><span>ƒêang chu·∫©n b·ªã test...</span><span class="status-icon">‚è≥</span></div>';
        document.getElementById('adminResults').innerHTML = '<div class="test-item"><span>ƒêang chu·∫©n b·ªã test...</span><span class="status-icon">‚è≥</span></div>';
        document.getElementById('errorSection').style.display = 'none';
        document.getElementById('summaryStats').style.display = 'none';
        
        testStats = { total: 0, success: 0, error: 0, warning: 0, tested: 0 };
        allErrors = [];
      }

      // Auto-start testing user pages on load
      window.addEventListener('DOMContentLoaded', function() {
        console.log('üß™ Comprehensive Website Tester loaded');
        console.log('üìã S·∫µn s√†ng test', USER_PAGES.length, 'user pages v√†', ADMIN_PAGES.length, 'admin pages');
      });
    </script>
  </body>
</html>
