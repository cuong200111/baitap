<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ” Kiá»ƒm tra Backend Status</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }
      .status-box {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        text-align: center;
      }
      .status-running {
        border-color: #22c55e;
        background: #f0f9ff;
      }
      .status-error {
        border-color: #ef4444;
        background: #fef2f2;
      }
      .status-loading {
        border-color: #f59e0b;
        background: #fffbeb;
      }
      .test-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
      }
      .test-btn:hover {
        background: #2563eb;
      }
      .code {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
        margin: 10px 0;
      }
      .problem-explanation {
        background: #fff3cd;
        border: 1px solid #ffc107;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .solution {
        background: #d1ecf1;
        border: 1px solid #17a2b8;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ” Kiá»ƒm tra tÃ¬nh tráº¡ng Backend Server</h1>

    <div class="problem-explanation">
      <h3>ğŸš¨ Váº¤N Äá»€ HIá»†N Táº I:</h3>
      <p>
        <strong>og:image</strong> hiá»ƒn thá»‹ sai áº£nh vÃ¬ <strong>Backend server khÃ´ng cháº¡y</strong>
      </p>
      <ul>
        <li>
          Trang <code>/products/7</code> cáº§n láº¥y dá»¯ liá»‡u tá»«
          <code>http://localhost:4000/api/products/7</code>
        </li>
        <li>Náº¿u backend khÃ´ng cháº¡y â†’ API tháº¥t báº¡i â†’ dÃ¹ng áº£nh máº·c Ä‘á»‹nh</li>
        <li>
          áº¢nh <code>file-1754323204656-522680178.jpg</code> lÃ  tá»« SEO settings,
          khÃ´ng pháº£i áº£nh sáº£n pháº©m 7
        </li>
      </ul>
    </div>

    <div class="status-box status-loading" id="statusBox">
      <h2>ğŸ”„ Äang kiá»ƒm tra...</h2>
      <p id="statusMessage">Vui lÃ²ng chá»...</p>
    </div>

    <div>
      <button class="test-btn" onclick="checkBackendStatus()">
        ğŸ”„ Kiá»ƒm tra láº¡i Backend
      </button>
      <button class="test-btn" onclick="checkProductAPI()">
        ğŸ§ª Test API sáº£n pháº©m 7
      </button>
      <button class="test-btn" onclick="checkOGImage()">
        ğŸ–¼ï¸ Kiá»ƒm tra og:image hiá»‡n táº¡i
      </button>
    </div>

    <div id="apiResults" style="margin-top: 20px;"></div>

    <div class="solution">
      <h3>âœ… CÃCH Sá»¬A Lá»–I:</h3>
      <h4>1. Khá»Ÿi Ä‘á»™ng Backend Server:</h4>
      <div class="code">
        # Má»Ÿ terminal má»›i<br />
        cd backend<br />
        npm install<br />
        npm start
        <br /><br />
        # Hoáº·c:<br />
        node server.js
      </div>

      <h4>2. Kiá»ƒm tra Backend Ä‘Ã£ cháº¡y:</h4>
      <div class="code">
        # Backend sáº½ cháº¡y trÃªn cá»•ng 4000<br />
        # Báº¡n sáº½ tháº¥y: "Server running on port 4000"
      </div>

      <h4>3. Test láº¡i trang sáº£n pháº©m:</h4>
      <div class="code">
        # Sau khi backend cháº¡y:<br />
        http://localhost:3000/products/7<br />
        # og:image sáº½ hiá»ƒn thá»‹ áº£nh Ä‘Ãºng cá»§a sáº£n pháº©m 7
      </div>
    </div>

    <script>
      const Domain = "http://localhost:4000";

      async function checkBackendStatus() {
        const statusBox = document.getElementById("statusBox");
        const statusMessage = document.getElementById("statusMessage");

        statusBox.className = "status-box status-loading";
        statusMessage.textContent = "Äang kiá»ƒm tra backend server...";

        try {
          const response = await fetch(`${Domain}/api/products`);

          if (response.ok) {
            statusBox.className = "status-box status-running";
            statusBox.innerHTML = `
              <h2>âœ… Backend Ä‘ang cháº¡y!</h2>
              <p>Server backend hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng trÃªn cá»•ng 4000</p>
              <p><strong>Giá» og:image sáº½ hoáº¡t Ä‘á»™ng Ä‘Ãºng!</strong></p>
            `;
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        } catch (error) {
          statusBox.className = "status-box status-error";
          statusBox.innerHTML = `
            <h2>âŒ Backend KHÃ”NG cháº¡y!</h2>
            <p><strong>Lá»—i:</strong> ${error.message}</p>
            <p>ÄÃ¢y lÃ  nguyÃªn nhÃ¢n og:image hiá»ƒn thá»‹ sai!</p>
            <p><strong>Cáº§n khá»Ÿi Ä‘á»™ng backend server Ä‘á»ƒ sá»­a lá»—i</strong></p>
          `;
        }
      }

      async function checkProductAPI() {
        const resultsDiv = document.getElementById("apiResults");
        resultsDiv.innerHTML = "<h3>ğŸ§ª Äang test API sáº£n pháº©m 7...</h3>";

        try {
          const response = await fetch(`${Domain}/api/products/7`);

          if (response.ok) {
            const data = await response.json();
            
            if (data.success && data.data) {
              const product = data.data;
              resultsDiv.innerHTML = `
                <h3>âœ… API sáº£n pháº©m 7 hoáº¡t Ä‘á»™ng!</h3>
                <div class="code">
                  <strong>Dá»¯ liá»‡u sáº£n pháº©m 7:</strong><br>
                  ID: ${product.id}<br>
                  TÃªn: ${product.name}<br>
                  áº¢nh chÃ­nh: ${product.image || 'KhÃ´ng cÃ³'}<br>
                  áº¢nh gallery: ${product.images ? product.images.length + ' áº£nh' : 'KhÃ´ng cÃ³'}<br>
                  <br>
                  <strong>og:image sáº½ dÃ¹ng:</strong> 
                  ${product.image ? `${Domain}/uploads/${product.image}` : 'áº¢nh tá»« gallery hoáº·c máº·c Ä‘á»‹nh'}
                </div>
              `;
            } else {
              resultsDiv.innerHTML = `<h3>âš ï¸ API tráº£ vá» dá»¯ liá»‡u khÃ´ng há»£p lá»‡</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        } catch (error) {
          resultsDiv.innerHTML = `
            <h3>âŒ KhÃ´ng thá»ƒ káº¿t ná»‘i API sáº£n pháº©m 7</h3>
            <p><strong>Lá»—i:</strong> ${error.message}</p>
            <p>Backend server chÆ°a cháº¡y!</p>
          `;
        }
      }

      async function checkOGImage() {
        const resultsDiv = document.getElementById("apiResults");
        resultsDiv.innerHTML = "<h3>ğŸ–¼ï¸ Äang kiá»ƒm tra og:image hiá»‡n táº¡i...</h3>";

        try {
          const response = await fetch("http://localhost:3000/products/7");
          const html = await response.text();

          const ogImageMatch = html.match(
            /<meta\s+property="og:image"\s+content="([^"]+)"/
          );
          const ogImage = ogImageMatch ? ogImageMatch[1] : null;

          const isBackendImage = ogImage && ogImage.includes("/uploads/");
          const isCorrectDomain = ogImage && ogImage.includes("localhost:4000");

          resultsDiv.innerHTML = `
            <h3>ğŸ“„ og:image hiá»‡n táº¡i:</h3>
            <div class="code">
              <strong>URL:</strong> ${ogImage || 'KhÃ´ng tÃ¬m tháº¥y'}<br>
              <strong>Tá»« backend:</strong> ${isBackendImage ? 'âœ… CÃ³' : 'âŒ KhÃ´ng'}<br>
              <strong>Domain Ä‘Ãºng:</strong> ${isCorrectDomain ? 'âœ… CÃ³' : 'âŒ KhÃ´ng'}<br>
              <br>
              ${
                isBackendImage && isCorrectDomain
                  ? '<strong style="color: green;">âœ… og:image hoáº¡t Ä‘á»™ng Ä‘Ãºng!</strong>'
                  : '<strong style="color: red;">âŒ og:image dÃ¹ng áº£nh fallback (backend chÆ°a cháº¡y)</strong>'
              }
            </div>
          `;
        } catch (error) {
          resultsDiv.innerHTML = `
            <h3>âŒ Lá»—i kiá»ƒm tra og:image</h3>
            <p><strong>Lá»—i:</strong> ${error.message}</p>
          `;
        }
      }

      // Tá»± Ä‘á»™ng kiá»ƒm tra khi trang load
      window.addEventListener("DOMContentLoaded", function () {
        checkBackendStatus();
      });
    </script>
  </body>
</html>
